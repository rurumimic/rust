# Private Registry

- cargo book: [registries](https://doc.rust-lang.org/cargo/reference/registries.html)

```bash
cargo new private_registry
cd private_registry
```

## Add a new registry

```bash
mkdir .cargo
```

### .cargo/config.toml

```toml
[registries]
sparse-registry = { index = "sparse+https://index.crates.io/" }
git-registry = { index = "https://github.com/rust-lang/crates.io-index" }

[registry]
default = "sparse-registry"
```

- sparse registry url must end in a slash `/`.

### Cargo.toml

```toml
[package]
name = "private_registry"
version = "0.1.0"
edition = "2024"
publish = false

[dependencies]
anyhow = { version = "*", registry = "sparse-registry" }
itoa = { version = "*", registry = "git-registry" }
```

## Build a project

```bash
cargo build
```

## Cargo.lock

```toml
# This file is automatically @generated by Cargo.
# It is not intended for manual editing.
version = 4

[[package]]
name = "anyhow"
version = "1.0.97"
source = "sparse+https://index.crates.io/"
checksum = "dcfed56ad506cb2c684a14971b8861fdc3baaaae314b9e5f9bb532cbe3ba7a4f"

[[package]]
name = "itoa"
version = "1.0.15"
source = "registry+https://github.com/rust-lang/crates.io-index"
checksum = "4a5f13b858c8d314ee3e8f639011f7ccefe71f97f96e50151fb991f267928e2c"

[[package]]
name = "private_registry"
version = "0.1.0"
dependencies = [
 "anyhow",
 "itoa",
]
```

---

## Offline Build

```bash
cargo vendor
```

### .cargo/config.toml

```toml
[source.vendored-sources]
directory = "vendor"

[source.crates-io]
replace-with = "vendored-sources"

[source."git+https://github.com/huggingface/candle.git?tag=0.9.0]
git = "https://github.com/huggingface/candle.git"
tag = "0.9.0"
replace-with = "vendored-sources"
```

### .gitignore

```txt
!vendor/**/*
!Cargo.lock
```

### Dockerfile

```dockerfile
FROM rust:alpine AS base
RUN apk add --no-cache musl-dev build-base protoc

FROM base AS builder
COPY app /app
WORKDIR /app
RUN cargo build --offline --release

FROM alpine AS production
WORKDIR /app
RUN mkdir -p bin
COPY --from=builder /app/target/release/myapp /app/bin/myapp

ENTRYPOINT ["./docker-entrypoint.sh"]
CMD ["./bin/myapp"]
```
